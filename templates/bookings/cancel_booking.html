{% extends 'base.html' %}

{% block title %}Cancel Booking - {{ booking.pnr }}{% endblock %}

{% block content %}
<div class="container">
    <div style="max-width: 600px; margin: 3rem auto;">
        <div class="search-card">
            <h2 style="text-align: center; color: #D97B3A; margin-bottom: 2rem;">Cancel Booking</h2>

            <div
                style="background: #fff3cd; padding: 1rem; border-radius: 8px; margin-bottom: 2rem; border: 1px solid #ffeaa7;">
                <p style="margin: 0; color: #856404;">
                    <strong>⚠️ Warning:</strong> Booking cancellation is permanent and cannot be undone.
                </p>
            </div>

            <!-- Booking Info -->
            <div style="background: #f9f9f9; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                <h4 style="margin-bottom: 1rem;">Booking Details</h4>
                <p><strong>PNR:</strong> {{ booking.pnr }}</p>
                <p><strong>Train:</strong> {{ booking.train.train_name }}</p>
                <p><strong>Route:</strong> {{ booking.origin_station.station_name }} → {{
                    booking.destination_station.station_name }}</p>
                <p><strong>Journey Date:</strong> {{ booking.journey_date|date:"d M, Y" }}</p>
                <p><strong>Total Fare:</strong> ৳{{ booking.total_fare }}</p>
            </div>

            <!-- Refund Calculation -->
            <div
                style="background: #d4edda; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem; border: 1px solid #c3e6cb;">
                <h4 style="margin-bottom: 1rem; color: #155724;">Refund Calculation</h4>
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span>Paid Amount:</span>
                    <span>৳{{ booking.total_fare }}</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                    <span>Cancellation Charge:</span>
                    <span style="color: #721c24;">- ৳100</span>
                </div>
                <hr style="margin: 1rem 0;">
                <div style="display: flex; justify-content: space-between; font-size: 1.25rem; font-weight: bold;">
                    <span>Refund Amount:</span>
                    <span style="color: #155724;">৳{{ booking.total_fare|add:"-100" }}</span>
                </div>
            </div>

            <!-- Cancellation Form -->
            <form method="POST" action="{% url 'bookings:cancel_booking' booking.id %}">
                {% csrf_token %}

                <div class="form-group">
                    <label for="reason">Reason for Cancellation (Optional)</label>
                    <textarea name="reason" id="reason" rows="4"
                        style="width: 100%; padding: 0.75rem; border: 1px solid #E0E0E0; border-radius: 5px;"
                        placeholder="Please provide a reason..."></textarea>
                </div>

                <div
                    style="background: #f8d7da; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; border: 1px solid #f5c6cb;">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" required style="margin-right: 0.5rem;">
                        <span style="color: #721c24;">I understand that this cancellation is permanent and the refund
                            will be processed according to the cancellation policy.</span>
                    </label>
                </div>

                <div style="display: flex; gap: 1rem;">
                    <button type="submit" class="btn btn-outline"
                        style="flex: 1; background: #dc3545; color: white; border-color: #dc3545;">Confirm
                        Cancellation</button>
                    <a href="{% url 'bookings:booking_detail' booking.pnr %}" class="btn btn-primary"
                        style="flex: 1; text-align: center; text-decoration: none;">Go Back</a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}